<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MLB Daily Lineups</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet" />
  <style>
    body { font-family: 'Roboto', sans-serif; margin: 20px; }
    h1 { margin-bottom: 10px; }
    #controls { margin-bottom: 10px; }
    input, button { margin-right: 8px; font-size: 1rem; padding: 4px; }
    #status { margin-top: 10px; font-style: italic; color: #555; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 6px 8px; text-align: left; }
    th { background: #f0f0f0; }
  </style>
</head>
<body>

  <h1>MLB Daily Lineups</h1>

  <div id="controls">
    <label for="datePicker">Date:</label>
    <input type="date" id="datePicker" />
    <button onclick="loadUnifiedLineups()">Load Lineups</button>
  </div>

  <div id="status">Choose a date to begin.</div>
  <table id="lineupTable">
    <thead>
      <tr>
        <th>Player</th>
        <th>Team</th>
        <th>Opponent</th>
        <th>Position</th>
        <th>Batting Order</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const datePicker = document.getElementById("datePicker");
    const statusDiv = document.getElementById("status");
    const tbody = document.querySelector("#lineupTable tbody");

    // Default to today
    const today = new Date().toISOString().slice(0,10);
    datePicker.value = today;

    async function loadUnifiedLineups() {
      const date = datePicker.value;
      statusDiv.textContent = `Loading games for ${date}...`;
      tbody.innerHTML = '';

      try {
        const scheduleRes = await fetch(`https://statsapi.mlb.com/api/v1/schedule?sportId=1&date=${date}`);
        const scheduleData = await scheduleRes.json();
        const games = scheduleData.dates?.[0]?.games;

        if (!games || games.length === 0) {
          throw new Error(`No games found for ${date}.`);
        }

        const allRows = [];

        for (const game of games) {
          const gamePk = game.gamePk;
          const gameRes = await fetch(`https://statsapi.mlb.com/api/v1.1/game/${gamePk}/feed/live`);
          const feed = await gameRes.json();

          const away = feed.liveData?.boxscore?.teams?.away;
          const home = feed.liveData?.boxscore?.teams?.home;

          const awayName = feed.gameData.teams.away.name;
          const homeName = feed.gameData.teams.home.name;

          const processTeam = (teamData, teamName, opponentName) => {
            if (!teamData?.battingOrder?.length) return;

            teamData.battingOrder.forEach(id => {
              const p = teamData.players['ID' + id];
              if (!p) return;
              allRows.push({
                name: p.person.fullName,
                team: teamName,
                opponent: opponentName,
                pos: p.position?.abbreviation || "â€“",
                order: p.battingOrder
              });
            });
          };

          processTeam(away, awayName, homeName);
          processTeam(home, homeName, awayName);
        }

        if (allRows.length === 0) {
          statusDiv.textContent = "No posted lineups found yet.";
        } else {
          statusDiv.textContent = `Loaded ${allRows.length} players from ${games.length} game(s).`;
          allRows.forEach(row => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${row.name}</td>
              <td>${row.team}</td>
              <td>${row.opponent}</td>
              <td>${row.pos}</td>
              <td>${row.order}</td>
            `;
            tbody.appendChild(tr);
          });
        }
      } catch (err) {
        console.error(err);
        statusDiv.textContent = `Error loading data: ${err.message}`;
      }
    }

    loadUnifiedLineups(); // Load today on page load
  </script>

</body>
</html>
