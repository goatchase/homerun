<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MLB Home Run Predictor</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      margin: 20px;
      background: #fff;
    }
    h1 {
      margin-bottom: 10px;
    }
    input[type="date"] {
      font-size: 1rem;
      padding: 4px 8px;
      margin-bottom: 10px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 10px;
    }
    th, td {
      padding: 6px 10px;
      border: 1px solid #ccc;
      text-align: left;
    }
    th {
      background: #f0f0f0;
    }
    #status {
      margin-top: 10px;
      font-style: italic;
    }
  </style>
</head>
<body>

<h1>MLB Home Run Predictor</h1>

<label for="datePicker">Select Date:</label>
<input type="date" id="datePicker" />

<div id="status">Loading lineups...</div>

<table id="lineup-table">
  <thead>
    <tr>
      <th>Game</th>
      <th>Batting Team</th>
      <th>Player</th>
      <th>Position</th>
      <th>Batting Order</th>
    </tr>
  </thead>
  <tbody>
    <!-- Lineup data rows go here -->
  </tbody>
</table>

<script>
  const datePicker = document.getElementById("datePicker");
  const statusDiv = document.getElementById("status");
  const tbody = document.querySelector("#lineup-table tbody");

  datePicker.valueAsDate = new Date(); // Default to today

  async function fetchLineups(dateStr) {
    tbody.innerHTML = "";
    statusDiv.textContent = "Loading lineups...";

    try {
      // Step 1: Get scheduled games for selected date
      const scheduleUrl = `https://statsapi.mlb.com/api/v1/schedule?sportId=1&date=${dateStr}`;
      const scheduleRes = await fetch(scheduleUrl);
      const scheduleData = await scheduleRes.json();
      const games = scheduleData.dates[0]?.games || [];

      if (games.length === 0) {
        statusDiv.textContent = "No games found for selected date.";
        return;
      }

      // Step 2: For each game, fetch lineup info from the live feed
      for (const game of games) {
        const gameId = game.gamePk;
        const gameFeedUrl = `https://statsapi.mlb.com/api/v1.1/game/${gameId}/feed/live`;
        const feedRes = await fetch(gameFeedUrl);
        const feedData = await feedRes.json();

        const gameLabel = `${feedData.gameData.teams.away.name} @ ${feedData.gameData.teams.home.name}`;

        // Away team lineup
        const awayPlayers = feedData.liveData?.boxscore?.teams?.away?.players || {};
        const awayBattingOrder = feedData.liveData?.boxscore?.teams?.away?.battingOrder || [];
        for (const playerId of awayBattingOrder) {
          const p = awayPlayers[playerId];
          const name = p.person.fullName;
          const pos = p.position.abbreviation;
          const order = p.battingOrder;
          tbody.insertAdjacentHTML("beforeend", `
            <tr>
              <td>${gameLabel}</td>
              <td>${feedData.gameData.teams.away.name}</td>
              <td>${name}</td>
              <td>${pos}</td>
              <td>${order}</td>
            </tr>
          `);
        }

        // Home team lineup
        const homePlayers = feedData.liveData?.boxscore?.teams?.home?.players || {};
        const homeBattingOrder = feedData.liveData?.boxscore?.teams?.home?.battingOrder || [];
        for (const playerId of homeBattingOrder) {
          const p = homePlayers[playerId];
          const name = p.person.fullName;
          const pos = p.position.abbreviation;
          const order = p.battingOrder;
          tbody.insertAdjacentHTML("beforeend", `
            <tr>
              <td>${gameLabel}</td>
              <td>${feedData.gameData.teams.home.name}</td>
              <td>${name}</td>
              <td>${pos}</td>
              <td>${order}</td>
            </tr>
          `);
        }
      }

      statusDiv.textContent = "Lineups loaded.";
    } catch (err) {
      console.error("Error fetching lineups:", err);
      statusDiv.textContent = "Failed to load lineups.";
    }
  }

  datePicker.addEventListener("change", () => {
    fetchLineups(datePicker.value);
  });

  fetchLineups(datePicker.value);
</script>

</body>
</html>
