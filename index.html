<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MLB Daily Lineups</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet" />
  <style>
    body { font-family: 'Roboto', sans-serif; margin: 20px; }
    h1 { margin-bottom: 10px; }
    #controls { margin-bottom: 10px; }
    input, button { margin-right: 8px; font-size: 1rem; padding: 4px; }
    #status { margin-top: 10px; font-style: italic; color: #555; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 6px 8px; text-align: left; }
    th { background: #f0f0f0; }
    .team-label { margin-top: 30px; font-size: 1.1rem; font-weight: bold; }
  </style>
</head>
<body>

  <h1>MLB Daily Lineups</h1>

  <div id="controls">
    <label for="datePicker">Date:</label>
    <input type="date" id="datePicker" />
    <button onclick="loadAllLineups()">Load All Lineups</button>
  </div>

  <div id="status">Choose a date to begin.</div>
  <div id="lineups"></div>

  <script>
    const status = document.getElementById('status');
    const lineupsDiv = document.getElementById('lineups');
    const datePicker = document.getElementById('datePicker');

    // Default to today
    const today = new Date().toISOString().slice(0,10);
    datePicker.value = today;

    async function loadAllLineups() {
      const date = datePicker.value;
      status.textContent = `Loading games for ${date}...`;
      lineupsDiv.innerHTML = '';

      try {
        const scheduleRes = await fetch(`https://statsapi.mlb.com/api/v1/schedule?sportId=1&date=${date}`);
        const scheduleData = await scheduleRes.json();
        const games = scheduleData.dates?.[0]?.games;
        if (!games || games.length === 0) throw new Error(`No games found for ${date}.`);

        status.textContent = `Found ${games.length} game(s). Fetching lineups...`;

        for (const game of games) {
          const gamePk = game.gamePk;
          const gameRes = await fetch(`https://statsapi.mlb.com/api/v1.1/game/${gamePk}/feed/live`);
          const feed = await gameRes.json();

          const away = feed.liveData?.boxscore?.teams?.away;
          const home = feed.liveData?.boxscore?.teams?.home;

          const awayName = feed.gameData.teams.away.name;
          const homeName = feed.gameData.teams.home.name;

          if (!away?.battingOrder?.length && !home?.battingOrder?.length) {
            const noDataDiv = document.createElement('div');
            noDataDiv.innerHTML = `<div class="team-label">${awayName} @ ${homeName}</div><div><em>No lineups posted yet.</em></div>`;
            lineupsDiv.appendChild(noDataDiv);
            continue;
          }

          const gameHeader = document.createElement('div');
          gameHeader.className = 'team-label';
          gameHeader.textContent = `${awayName} @ ${homeName}`;
          lineupsDiv.appendChild(gameHeader);

          [ ['away', away, awayName], ['home', home, homeName] ].forEach(([side, teamData, teamLabel]) => {
            if (!teamData?.battingOrder?.length) return;

            const table = document.createElement('table');
            const titleRow = document.createElement('tr');
            titleRow.innerHTML = `<th colspan="4">${teamLabel} (${side})</th>`;
            table.appendChild(titleRow);

            const header = document.createElement('tr');
            header.innerHTML = '<th>#</th><th>Player</th><th>Pos</th><th>Order</th>';
            table.appendChild(header);

            teamData.battingOrder.forEach(id => {
              const p = teamData.players['ID' + id];
              if (!p) return;
              const tr = document.createElement('tr');
              tr.innerHTML = `
                <td>${p.battingOrder}</td>
                <td>${p.person.fullName}</td>
                <td>${p.position?.abbreviation || 'â€“'}</td>
                <td>${p.battingOrder}</td>
              `;
              table.appendChild(tr);
            });

            lineupsDiv.appendChild(table);
          });
        }

        status.textContent = `Lineups loaded for ${date}.`;
      } catch (err) {
        console.error(err);
        status.textContent = `Error loading data: ${err.message}`;
      }
    }

    // Load today's by default
    loadAllLineups();
  </script>

</body>
</html>
