<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MLB Lineup & HR Predictor</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet" />
  <style>
    body { font-family: 'Roboto', sans-serif; margin: 20px; }
    h1 { margin-bottom: 10px; }
    #controls { margin-bottom: 10px; }
    input, select, button { margin-right: 8px; font-size: 1rem; padding: 4px; }
    #status { margin-top: 10px; font-style: italic; color: #555; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 6px 8px; text-align: left; }
    th { background: #f0f0f0; }
  </style>
</head>
<body>

  <h1>MLB Lineup & HR Predictor</h1>

  <div id="controls">
    <label for="datePicker">Date:</label>
    <input type="date" id="datePicker" />
    <button onclick="loadSchedule()">Load Games</button>
    <select id="gameSelect" onchange="loadLineups(this.value)"></select>
    <button onclick="loadLineups(gameSelect.value)">Refresh Lineups</button>
  </div>

  <div id="status">Choose a date and load games to begin.</div>
  <div id="lineups"></div>

  <script>
    const status = document.getElementById('status');
    const lineupsDiv = document.getElementById('lineups');
    const gameSelect = document.getElementById('gameSelect');
    const datePicker = document.getElementById('datePicker');

    // Default date to today
    const today = new Date().toISOString().slice(0,10);
    datePicker.value = today;

    async function loadSchedule() {
      const date = datePicker.value;
      status.textContent = `Loading games for ${date}...`;
      gameSelect.innerHTML = '';
      lineupsDiv.innerHTML = '';

      try {
        const res = await fetch(`https://statsapi.mlb.com/api/v1/schedule?sportId=1&date=${date}`);
        const data = await res.json();
        const games = data.dates?.[0]?.games;
        if (!games || games.length === 0) throw new Error(`No games found for ${date}.`);

        status.textContent = `Found ${games.length} game(s) on ${date}.`;
        games.forEach(game => {
          const away = game.teams.away.team.name;
          const home = game.teams.home.team.name;
          const option = document.createElement('option');
          option.value = game.gamePk;
          option.textContent = `${away} @ ${home}`;
          gameSelect.appendChild(option);
        });

        loadLineups(games[0].gamePk);
      } catch (err) {
        status.textContent = `Schedule error: ${err.message}`;
      }
    }

    async function loadLineups(gamePk) {
      status.textContent = 'Loading lineups...';
      lineupsDiv.innerHTML = '';

      try {
        const res = await fetch(`https://statsapi.mlb.com/api/v1.1/game/${gamePk}/feed/live`);
        const feed = await res.json();
        console.log('Feed Live JSON:', feed);

        const away = feed.liveData?.boxscore?.teams?.away;
        const home = feed.liveData?.boxscore?.teams?.home;

        if ([away, home].every(tm => !tm?.battingOrder?.length)) {
          status.textContent = 'Lineups not yet posted. You can Refresh.';
          return;
        }

        status.textContent = 'Lineups loaded!';
        ['away', 'home'].forEach(side => {
          const team = feed.liveData.boxscore.teams[side];
          const name = feed.gameData.teams[side].name;

          const tbl = document.createElement('table');
          const th = document.createElement('tr');
          th.innerHTML = `<th colspan="4">${name} (${side})</th>`;
          tbl.appendChild(th);

          const head = document.createElement('tr');
          head.innerHTML = '<th>#</th><th>Player</th><th>Pos</th><th>Order</th>';
          tbl.appendChild(head);

          team.battingOrder.forEach(id => {
            const p = team.players['ID' + id];
            if (!p) return;
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td>${p.battingOrder}</td>
              <td>${p.person.fullName}</td>
              <td>${p.position?.abbreviation || 'â€“'}</td>
              <td>${p.battingOrder}</td>
            `;
            tbl.appendChild(tr);
          });

          lineupsDiv.appendChild(tbl);
        });
      } catch (err) {
        console.error(err);
        status.textContent = `Lineups load error: ${err.message}`;
      }
    }

    // Initialize
    loadSchedule();
  </script>

</body>
</html>
