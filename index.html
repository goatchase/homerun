<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MLB Lineups Viewer</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      margin: 20px;
      background: #fff;
    }
    h1 {
      margin-bottom: 10px;
    }
    #date-selector {
      margin-bottom: 20px;
      font-size: 14px;
      padding: 6px 8px;
    }
    #status {
      margin-bottom: 10px;
      font-style: italic;
      color: #555;
    }
    .game {
      margin-bottom: 25px;
      border: 1px solid #ccc;
      padding: 12px;
      border-radius: 8px;
      background: #f9f9f9;
    }
    .team-name {
      font-weight: bold;
      margin-top: 8px;
    }
    ul {
      padding-left: 20px;
      margin: 4px 0 10px;
    }
  </style>
</head>
<body>

  <h1>MLB Lineups Viewer</h1>

  <input type="date" id="date-selector" />
  <div id="status">Loading games...</div>
  <div id="games-container"></div>

  <script>
    const statusDiv = document.getElementById('status');
    const container = document.getElementById('games-container');
    const dateInput = document.getElementById('date-selector');

    // Set default to today
    const today = new Date().toISOString().split("T")[0];
    dateInput.value = today;

    dateInput.addEventListener("change", () => {
      loadGames(dateInput.value);
    });

    async function loadGames(dateStr) {
      statusDiv.textContent = "Loading games...";
      container.innerHTML = "";

      try {
        const response = await fetch(`https://statsapi.mlb.com/api/v1/schedule?sportId=1&date=${dateStr}`);
        const scheduleData = await response.json();

        const games = scheduleData.dates[0]?.games || [];

        if (!games.length) {
          statusDiv.textContent = "No games found for that date.";
          return;
        }

        statusDiv.textContent = `Found ${games.length} games for ${dateStr}.`;

        for (const game of games) {
          const gameId = game.gamePk;
          const boxscoreRes = await fetch(`https://statsapi.mlb.com/api/v1/game/${gameId}/boxscore`);
          const boxscore = await boxscoreRes.json();

          const homeTeam = game.teams.home.team.name;
          const awayTeam = game.teams.away.team.name;

          const homeLineup = extractLineup(boxscore.teams.home);
          const awayLineup = extractLineup(boxscore.teams.away);

          const div = document.createElement("div");
          div.className = "game";
          div.innerHTML = `
            <div><strong>${awayTeam}</strong> @ <strong>${homeTeam}</strong></div>
            <div class="team-name">${awayTeam} Batting Order:</div>
            <ul>${awayLineup.map(p => `<li>${p}</li>`).join("")}</ul>
            <div class="team-name">${homeTeam} Batting Order:</div>
            <ul>${homeLineup.map(p => `<li>${p}</li>`).join("")}</ul>
          `;
          container.appendChild(div);
        }

      } catch (err) {
        console.error(err);
        statusDiv.textContent = "Error loading games.";
      }
    }

    function extractLineup(teamData) {
      const players = teamData.players;
      const battingOrder = [];

      // Filter and order by batting order
      Object.values(players).forEach(player => {
        if (player.position?.abbreviation !== "P" && player.stats?.batting?.battingOrder) {
          battingOrder.push({
            name: player.person.fullName,
            order: parseInt(player.stats.batting.battingOrder)
          });
        }
      });

      // Sort by batting order (they come in 100, 200, ... form)
      battingOrder.sort((a, b) => a.order - b.order);

      return battingOrder.map(p => p.name);
    }

    loadGames(today);
  </script>

</body>
</html>
