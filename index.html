<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MLB Lineup Viewer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px 8px;
      text-align: left;
    }
    th {
      background: #eee;
    }
    h1 {
      margin-bottom: 0;
    }
    .team-header {
      background: #ddd;
      font-weight: bold;
    }
    #controls {
      margin-top: 10px;
    }
    button {
      margin-left: 10px;
    }
  </style>
</head>
<body>

<h1>MLB Lineup Viewer</h1>
<div id="controls">
  <label for="date">Select Date:</label>
  <input type="date" id="date" />
  <select id="game-select"></select>
  <button onclick="fetchSchedule()">Load Games</button>
</div>

<div id="status" style="margin-top: 10px;">Select a date to load games.</div>
<div id="lineups"></div>

<script>
  const status = document.getElementById("status");
  const select = document.getElementById("game-select");
  const container = document.getElementById("lineups");
  const dateInput = document.getElementById("date");

  // Set default date to today
  const today = new Date().toISOString().slice(0, 10);
  dateInput.value = today;

  select.onchange = () => loadLineups(select.value);

  async function fetchSchedule() {
    const selectedDate = dateInput.value;
    status.textContent = `Loading games for ${selectedDate}...`;
    container.innerHTML = "";
    select.innerHTML = "";

    const url = `https://statsapi.mlb.com/api/v1/schedule?sportId=1&date=${selectedDate}`;
    try {
      const res = await fetch(url);
      const data = await res.json();

      if (!data.dates?.length || data.dates[0].games.length === 0) {
        throw new Error("No games scheduled for this date.");
      }

      const games = data.dates[0].games;
      status.textContent = `Found ${games.length} game(s) on ${selectedDate}.`;

      select.innerHTML = games.map(g => {
        const home = g.teams.home.team.name;
        const away = g.teams.away.team.name;
        return `<option value="${g.gamePk}">${away} @ ${home}</option>`;
      }).join("");

      // Auto-load first game's lineups
      if (games.length > 0) loadLineups(games[0].gamePk);
    } catch (err) {
      status.textContent = `Schedule error: ${err.message}`;
    }
  }

  async function loadLineups(gamePk) {
    status.textContent = "Loading lineups...";
    container.innerHTML = "";

    try {
      const res = await fetch(`https://statsapi.mlb.com/api/v1/game/${gamePk}/boxscore`);
      const data = await res.json();
      console.log("Boxscore data:", data);

      const home = data.teams.home;
      const away = data.teams.away;

      if (!home.lineupOrder?.length && !away.lineupOrder?.length) {
        status.textContent = "Lineups not yet posted. Click Refresh below.";
        container.innerHTML = `<button onclick="loadLineups(${gamePk})">üîÅ Refresh Lineups</button>`;
        return;
      }

      status.textContent = "Lineups loaded!";
      ["away", "home"].forEach(teamKey => {
        const team = data.teams[teamKey];
        const title = team.team.name + (teamKey === "home" ? " (Home)" : " (Away)");
        const table = document.createElement("table");

        const headerRow = document.createElement("tr");
        headerRow.innerHTML = `<th colspan="3">${title}</th>`;
        table.appendChild(headerRow);

        const labelRow = document.createElement("tr");
        labelRow.innerHTML = `<th>#</th><th>Position</th><th>Name</th>`;
        table.appendChild(labelRow);

        team.lineupOrder?.forEach((id, idx) => {
          const player = team.players["ID" + id];
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${idx + 1}</td>
            <td>${player.position?.abbreviation ?? "‚Äì"}</td>
            <td>${player.person.fullName}</td>`;
          table.appendChild(tr);
        });

        container.appendChild(table);
      });
    } catch (err) {
      status.textContent = `Lineup error: ${err.message}`;
      console.error(err);
    }
  }

  // Auto-load today's games on page load
  fetchSchedule();
</script>

</body>
</html>
